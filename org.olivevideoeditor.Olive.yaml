app-id: org.olivevideoeditor.Olive
default-branch: beta
desktop-file-name-suffix: ' (Beta)'
runtime: org.kde.Platform
sdk: org.kde.Sdk
runtime-version: '5.14'
command: olive-editor
finish-args:
  - --socket=wayland
  - --socket=x11
  - --share=ipc
  - --device=dri
  - --socket=pulseaudio
  - --filesystem=host
cleanup:
  - /include
  - /lib/pkgconfig
modules:

  - name: OpenColorIO
    buildsystem: cmake # ninja build broken (fixed in 2.0)
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DOCIO_BUILD_STATIC=OFF
      - -DCMAKE_CXX_FLAGS='-Wno-error=deprecated-declarations -Wno-error=unused-function -Wno-error=cast-function-type'
    cleanup:
      - /bin
    sources:
      - type: archive
        url: https://github.com/imageworks/OpenColorIO/archive/v1.1.1.tar.gz
        sha256: c9b5b9def907e1dafb29e37336b702fff22cc6306d445a13b1621b8a754c14c8

  - name: boost
    buildsystem: simple
    build-commands:
      - ./bootstrap.sh --prefix=/app --with-libraries=system,filesystem,thread
      - ./b2 install variant=release link=shared runtime-link=shared cxxflags="$CXXFLAGS" linkflags="$LDFLAGS" -j $FLATPAK_BUILDER_N_JOBS
    sources:
      - type: archive
        url: https://dl.bintray.com/boostorg/release/1.72.0/source/boost_1_72_0.tar.bz2
        sha256: 59c9b274bc451cf91a9ba1dd2c7fdcaf5d60b1b3aa83f2c9fa143417cc660722

  - name: openexr
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
    cleanup:
      - /bin
      - /share/doc
    sources:
      - type: archive
        url: https://github.com/AcademySoftwareFoundation/openexr/archive/v2.4.1.tar.gz
        sha256: 3ebbe9a8e67edb4a25890b98c598e9fe23b10f96d1416d6a3ff0732e99d001c1

  - name: fmtlib
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DFMT_TEST=OFF
    sources:
      - type: archive
        url: https://github.com/fmtlib/fmt/archive/6.1.2.tar.gz
        sha256: 1cafc80701b746085dddf41bd9193e6d35089e1c6ec1940e037fcb9c98f62365

  - name: robin-map
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
    sources:
      - type: archive
        url: https://github.com/Tessil/robin-map/archive/v0.6.2.tar.gz
        sha256: c08ec4b1bf1c85eb0d6432244a6a89862229da1cb834f3f90fba8dc35d8c8ef1

  - name: OpenImageIO
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DUSE_PYTHON=OFF
    sources:
      - type: archive
        url: https://github.com/OpenImageIO/oiio/archive/Release-2.1.12.0.tar.gz
        sha256: da27e191349ef473220c7a373921e6d4c69d9924acd87140af55ce9d00ad58f8

  - name: 'x264'
    config-opts:
      - --disable-cli
      - --enable-shared
    sources:
      - type: archive
        url: https://download.videolan.org/x264/snapshots/x264-snapshot-20190305-2245-stable.tar.bz2
        sha256: be52c96ef8bd930fbc1ecff03abac9b94976b444ea7641345e08e20d9e594d16

  - name: 'x265'
    buildsystem: cmake-ninja
    builddir: true
    subdir: source
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
    cleanup:
      - /bin
    sources:
      - type: archive
        url: https://bitbucket.org/multicoreware/x265/downloads/x265_3.3.tar.gz
        sha256: f26e148ed1f4dfb33fd1eb3ff5e60e08078d1b2017e88bcbb045b3fb58300b9c

  - name: ffmpeg
    config-opts:
      - --disable-static
      - --enable-shared
      - --disable-debug
      - --disable-doc
      - --enable-gpl
      - --disable-programs
      - --enable-libopus
      - --enable-libvpx
      - --enable-librsvg
      - --enable-libx264
      - --enable-libx265
    cleanup:
      - /share/ffmpeg/examples
    sources:
      - type: archive
        url: https://www.ffmpeg.org/releases/ffmpeg-4.2.2.tar.xz
        sha256: cb754255ab0ee2ea5f66f8850e1bd6ad5cac1cd855d0a2f4990fb8c668b0d29c

  - name: olive
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
    sources:
      - type: git
        url: https://github.com/olive-editor/olive.git
        commit: 4bc5378116771266dad9120ccd22ec446e3dc359
