app-id: org.olivevideoeditor.Olive
default-branch: beta
desktop-file-name-suffix: ' (Beta)'
runtime: org.kde.Platform
sdk: org.kde.Sdk
runtime-version: '5.15'
command: olive-editor
finish-args:
  - --socket=wayland
  - --socket=x11
  - --share=ipc
  - --device=dri
  - --socket=pulseaudio
  - --filesystem=host
cleanup:
  - /include
  - /lib/pkgconfig
modules:

  - name: openexr
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
    cleanup:
      - /bin
      - /share/doc
    sources:
      - type: git
        url: https://github.com/AcademySoftwareFoundation/openexr.git
        commit: c32f82c5f1833d959321fc5f615ca52836c7ba65
        tag: v2.5.3

  - name: fmtlib
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DFMT_TEST=OFF
    sources:
      - type: git
        url: https://github.com/fmtlib/fmt.git
        commit: 7bdf0628b1276379886c7f6dda2cef2b3b374f0b
        tag: '7.1.3'

  - name: robin-map
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
    sources:
      - type: git
        url: https://github.com/Tessil/robin-map.git
        commit: 622443f40544fb6a693402e69c1328d685eac939
        tag: v0.6.3

  - name: boost
    buildsystem: simple
    build-commands:
      - ./bootstrap.sh --prefix=/app --with-libraries=filesystem,system,thread
      - ./b2 install variant=release link=shared runtime-link=shared cxxflags="$CXXFLAGS" linkflags="$LDFLAGS" -j $FLATPAK_BUILDER_N_JOBS
    sources:
      - type: archive
        url: https://dl.bintray.com/boostorg/release/1.74.0/source/boost_1_74_0.tar.bz2
        sha256: 83bfc1507731a0906e387fc28b7ef5417d591429e51e788417fe9ff025e116b1

  - name: OpenImageIO
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      # - -DBoost_ROOT=/app/include/boost
      - -DUSE_PYTHON=OFF
      - -DVERBOSE=ON
    sources:
      - type: git
        url: https://github.com/OpenImageIO/oiio.git
        commit: 99d6947b8d10a0467c47f14cf6006060f22473c6
        tag: Release-2.2.9.0

  - name: yaml-cpp
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DCMAKE_POSITION_INDEPENDENT_CODE=ON
      - -DYAML_CPP_BUILD_TESTS=OFF
    sources:
      - type: git
        url: https://github.com/jbeder/yaml-cpp.git
        commit: 9a3624205e8774953ef18f57067b3426c1c5ada6
        tag: yaml-cpp-0.6.3

  - name: pystring
    buildsystem: simple
    build-commands:
      - sed -e 's|/usr|/app|g' -i Makefile
      - make -j $FLATPAK_BUILDER_N_JOBS install
      - install -Dm644 pystring.h -t /app/include/pystring
    sources:
      - type: git
        url: https://github.com/imageworks/pystring.git
        commit: c2de99deb4f0bd13751f8436400b5e8662301769
        tag: v1.1.3

  - name: OpenColorIO
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DOCIO_BUILD_STATIC=OFF
      - -DOCIO_BUILD_APPS=OFF
      - -DOCIO_BUILD_TESTS=OFF
      - -DOCIO_BUILD_GPU_TESTS=OFF
      - -DOCIO_BUILD_PYTHON=OFF
      # - -Dpystring_INCLUDE_DIR=/app/include
    cleanup:
      - /bin
    sources:
      - type: git
        url: https://github.com/AcademySoftwareFoundation/OpenColorIO.git
        commit: a712243771660fa5094a9409fcfa1076cf6decd5
        tag: v2.0.0-beta2

  - name: 'x264'
    config-opts:
      - --disable-cli
      - --enable-shared
    sources:
      - type: git
        url: https://code.videolan.org/videolan/x264.git
        commit: d198931a63049db1f2c92d96c34904c69fde8117

  - name: 'x265'
    buildsystem: cmake-ninja
    builddir: true
    subdir: source
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DENABLE_CLI=OFF
    sources:
      - type: archive
        url: https://deb.debian.org/debian/pool/main/x/x265/x265_3.4.orig.tar.gz
        sha256: c2047f23a6b729e5c70280d23223cb61b57bfe4ad4e8f1471eeee2a61d148672

  - name: ffmpeg
    config-opts:
      - --disable-static
      - --enable-shared
      - --disable-debug
      - --disable-doc
      - --enable-gpl
      - --disable-programs
      - --enable-libopus
      - --enable-libvpx
      - --enable-librsvg
      - --enable-libx264
      - --enable-libx265
    cleanup:
      - /share/ffmpeg/examples
    sources:
      - type: archive
        url: https://www.ffmpeg.org/releases/ffmpeg-4.2.4.tar.xz
        sha256: 0d5da81feba073ee78e0f18e0966bcaf91464ae75e18e9a0135186249e3d2a0b

  - name: olive
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
    sources:
      - type: git
        url: https://github.com/olive-editor/olive.git
        commit: 0699795c6f2e81d7c1594f9815dde11468e9c791
